%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Newcommand: framestructure

\pgfkeys{
 /framestructure/.is family, /framestructure,
  default/.style = {number of storys = 5,
  number of bays = 3,
  story height = 1cm,
  bay width = 2cm,
  startX = 0cm,
  startY = 0cm,
  support width = 0.3cm,
  support height = 0.15cm},
  number of storys/.estore in = \ns,
  number of bays/.estore in = \nb,
  story height/.estore in = \sh,
  bay width/.estore in = \bw,
  startX/.estore in = \startx,
  startY/.estore in = \starty,
  support width/.estore in = \supw,
  support height/.estore in = \suph
 }

\newcommand{\framestructure}[1][]{
\pgfkeys{/framestructure, default, #1}
\tikzmath{
int \ns, \nb, \ncol, \nlev, \nlevmo, \ncolmo, \i, \j;
real \sh, \bw, \startx, \starty, \xx, \y;
real \supw, \suph;
coordinate \c;
\ncol = \nb+1; %number of columns
\nlev = \ns+1; %number of levels
if \ns>1 then {\nlevmo = \nlev-1;} else {\nlevmo=2;};
if \nb>1 then {\ncolmo = \ncol-1;} else {\ncolmo=2;};
for \i in {1,...,{\nlev}}{
\y{\i} = \starty + (\i-1)*\sh;
for \j in {1,...,{\ncol}}{
\x{\j} = \startx + (\j-1)*\bw;
};
};
%print{\nlevmo};
}
\draw [line width=0pt, color = white] (0, \y{\nlev}+2);
\draw [line width = 1pt] (\x{1},\y{1}) -- (\x{1}, \y{\nlev}) -- (\x{\ncol}, \y{\nlev}) -- (\x{\ncol}, \y{1});
\foreach \i in {2,...,{\nlevmo}}
{
\draw [line width = 1pt] (\x{1},\y{\i}) -- (\x{\ncol},\y{\i});
}

\foreach \j in {2,...,{\ncolmo}}
{
\draw [line width = 1pt] (\x{\j},\y{1}) -- (\x{\j},\y{\nlev});
}

\draw [{->}] (\x{\ncol}+\supw,\y{1}) -- +(1,0) node[anchor=west]{$X$};
\draw [{->}] (\x{1},\y{\nlev}+0.5) -- +(0,1) node[anchor=east]{$Y$};

\foreach \j in {1,...,{\ncol}}
{
\filldraw [gray] (\x{\j},\y{1}) +({-\supw/2},-\suph) rectangle +({\supw/2},\y{1});
\draw [line width = 2pt] (\x{\j},\y{1}) +({-\supw/2},\y{1}) -- +({\supw/2},\y{1});
}

}
% end framestructure
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\begin{tikzpicture}
%\framestructure[number of storys=4, number of bays=2, story height=1, bay width=4, startX=0, startY=0, support width=0.7, support height=0.2]
%\end{tikzpicture}

